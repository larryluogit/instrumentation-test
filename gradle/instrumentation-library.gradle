ext {
  noShadowPublish = true
}

group = 'io.opentelemetry.instrumentation'

apply from: "$rootDir/gradle/java.gradle"
apply from: "$rootDir/gradle/publish.gradle"

archivesBaseName = projectDir.parentFile.name

dependencies {
  api project(':instrumentation-api')

  api deps.opentelemetryApi

  testImplementation project(':testing-common')
}

if (!ext.properties.noShadow) {

  apply plugin: 'com.github.johnrengelman.shadow'

  shadowJar {
    archiveClassifier = 'agent'

    configurations = []

    relocate "io.opentelemetry.instrumentation.${javaSubPackage}", "io.opentelemetry.auto.instrumentation.${javaSubPackage}.shaded"
  }
}

afterEvaluate {
  archivesBaseName = 'opentelemetry-' + archivesBaseName
}